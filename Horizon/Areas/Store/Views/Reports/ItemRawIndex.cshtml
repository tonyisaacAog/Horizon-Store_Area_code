<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>كارت صنف لمستلزمات الانتاج</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body class="bg-gray-50 font-sans">
    <div id="app" class="container mx-auto px-4 py-6">
        <!-- Messages Component -->
        <messages :messages="messages" @@clear-messages="clearMessages"></messages>

        <!-- Page Title -->
        <div class="flex justify-between items-center mb-8 mt-4">
            <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" class="stroke-[#212b36]"
                    viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M3 3h18v18H3zM9 9h6v6H9z" />
                    <path d="M9 3v6M15 3v6M3 9h18M3 15h18" />
                </svg>
                <h1 class="text-2xl text-[#212b36] font-bold">{{ title }}</h1>
            </div>
            <a href="javascript:history.back()"
                class="bg-[#212b36] hover:bg-[#222] text-white px-4 py-2 rounded-lg inline-flex items-center gap-2 transition-colors">
                رجوع
                <i class="fa fa-arrow-left"></i>
            </a>
        </div>

        <!-- Raw Material Information Card -->
        <div class="bg-white rounded-lg shadow-md mb-6 overflow-hidden">
            <div class="text-gray-900 px-6 py-4 flex items-center border-b">
                <h2 class="text-lg font-semibold">{{ title }}</h2>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">اسم المادة</label>
                        <span class="block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md">
                            {{ storeItemRaw.ItemName }}
                        </span>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">اسم المادة عربى</label>
                        <span class="block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md">
                            {{ storeItemRaw.ItemNameAr }}
                        </span>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">نوع المادة</label>
                        <span class="block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md">
                            {{ storeItemRaw.RawItemTypeName }}
                        </span>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">الكمية</label>
                        <span class="block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md">
                            {{ storeItemRaw.QTY }}
                        </span>
                    </div>
                </div>

                <!-- Balance Display -->
                <div class="grid grid-cols-1 md:grid-cols-1 gap-4 mb-6">
                    <div class="text-center">
                        <label class="block text-sm font-medium text-gray-700 mb-2">الرصيد</label>
                        <div
                            class="bg-blue-50 border border-blue-200 text-blue-800 px-4 py-3 rounded-md text-lg font-semibold">
                            {{ storeItemRaw.Balance }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transaction Details Card -->
        <div class="bg-white rounded-lg shadow-md mb-6 overflow-hidden">
            <div class="text-gray-900 px-6 py-4 flex items-center border-b">
                <h2 class="text-lg font-semibold">تفاصيل التحركات</h2>
            </div>
            <div class="p-6">
                <!-- Date Range Filter -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">من</label>
                        <input v-model="transactionRawContainer.Search.StartDate" type="date"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">الى</label>
                        <input v-model="transactionRawContainer.Search.EndDate" type="date"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex items-end">
                        <button @@click="loadReport"
                            class="w-full bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-md flex items-center justify-center gap-2 transition-colors h-[48px]">
                            <i class="fas fa-search"></i>
                            عرض التقرير
                        </button>
                    </div>
                </div>

                <!-- Balance Summary -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">رصيد أول المدة</label>
                        <span class="block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md">
                            {{ transactionRawContainer.Search.StartBalance }}
                        </span>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">رصيد أخر المدة</label>
                        <span class="block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md">
                            {{ transactionRawContainer.Search.EndBalance }}
                        </span>
                    </div>
                </div>

                <!-- Raw Material Transactions Table -->
                <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                    <div class="text-gray-900 px-6 py-3 flex items-center">
                        <h3 class="text-lg font-semibold">تفاصيل الحركات</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 border border-gray-300">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th
                                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b">
                                        التاريخ
                                    </th>
                                    <th
                                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b">
                                        الكمية
                                    </th>
                                    <th
                                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b">
                                        الكمية بعد
                                    </th>
                                    <th
                                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b">
                                        الوصف
                                    </th>
                                    <th
                                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b">
                                        نوع العملية
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr v-for="(transaction, index) in transactionRawContainer.StoreItemRawTransactions"
                                    :key="'transaction-'+index" class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b">
                                        {{ formatDate(transaction.TransDate) }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b">
                                        {{ transaction.QTY }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b">
                                        {{ transaction.QtyAfter }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b">
                                        {{ transaction.Descrpition }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b">
                                        <a v-if="transaction.TransType === 0"
                                            :href="'/Purchases/Home/DetailsPurchase/' + transaction.ReferanceId"
                                            target="_blank"
                                            class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs transition-colors">
                                            {{ transaction.TransTypeName }}
                                        </a>
                                        <a v-else-if="transaction.TransType === 1"
                                            :href="'/Manufacturing/Home/DetailsManufacturing/' + transaction.ReferanceId"
                                            target="_blank"
                                            class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs transition-colors">
                                            {{ transaction.TransTypeName }}
                                        </a>
                                        <span v-else-if="transaction.TransType === 3"
                                            class="bg-cyan-600 text-white px-3 py-1 rounded text-xs">
                                            {{ transaction.TransTypeName }}
                                        </span>
                                        <span v-else class="text-gray-600">{{ transaction.TransTypeName }}</span>
                                    </td>
                                </tr>
                                <tr v-if="transactionRawContainer.StoreItemRawTransactions.length === 0">
                                    <td colspan="5" class="text-center text-lg text-gray-500 py-8">
                                        لا توجد حركات للعرض
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.47/dist/vue.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // Sample initial data - replace with server data
        var initialData = {
            StoreItemRaw: {
                ItemName: "خام القطن",
                ItemNameAr: "خام القطن العربي",
                RawItemTypeName: "خامات نسجية",
                QTY: 1000,
                Balance: 850,
                Id: 1
            },
            TransactionRawContainer: {
                Search: {
                    StartDate: '',
                    EndDate: '',
                    StartBalance: 0,
                    EndBalance: 0
                },
                StoreItemRawTransactions: []
            }
        };

        // Messages Component
        const Messages = {
            template: `
                <div v-if="messages.length > 0" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                        <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-medium text-gray-900">رسائل</h3>
                            <button @@click="$emit('clear-messages')" class="text-gray-500 hover:text-gray-700">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <div class="p-4">
                            <ul class="space-y-2">
                                <li v-for="(message, index) in messages" :key="index" class="text-red-600 text-sm">{{ message }}</li>
                            </ul>
                        </div>
                        <div class="p-4 border-t border-gray-200 flex justify-end">
                            <button @@click="$emit('clear-messages')" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                موافق
                            </button>
                        </div>
                    </div>
                </div>
            `,
            props: ['messages'],
            emits: ['clear-messages']
        };

        const { createApp } = Vue;

        createApp({
            components: {
                Messages
            },
            data() {
                return {
                    title: "كارت صنف لمستلزمات الانتاج",
                    storeItemRaw: initialData.StoreItemRaw || {},
                    transactionRawContainer: {
                        Search: {
                            StartDate: initialData.TransactionRawContainer?.Search?.StartDate || '',
                            EndDate: initialData.TransactionRawContainer?.Search?.EndDate || '',
                            StartBalance: initialData.TransactionRawContainer?.Search?.StartBalance || 0,
                            EndBalance: initialData.TransactionRawContainer?.Search?.EndBalance || 0,
                            StoreItemRawId: initialData.StoreItemRaw?.Id || 0
                        },
                        StoreItemRawTransactions: initialData.TransactionRawContainer?.StoreItemRawTransactions || []
                    },
                    messages: []
                };
            },
            methods: {
                loadReport() {
                    this.messages = [];

                    // Basic validation
                    if (!this.transactionRawContainer.Search.StartDate) {
                        this.messages.push('برجاء اختيار تاريخ البداية');
                    }
                    if (!this.transactionRawContainer.Search.EndDate) {
                        this.messages.push('برجاء اختيار تاريخ النهاية');
                    }

                    if (this.messages.length > 0) {
                        return;
                    }

                    // Set StoreItemRawId
                    this.transactionRawContainer.Search.StoreItemRawId = this.storeItemRaw.Id;

                    // Clear existing transactions
                    this.transactionRawContainer.StoreItemRawTransactions = [];

                    // Make API call - replace with actual endpoint
                    axios.post('/Store/Reports/LoadRawReport', this.transactionRawContainer)
                        .then(response => {
                            if (response.data && response.data.Result) {
                                const result = response.data.Result;
                                this.transactionRawContainer.Search.StartBalance = result.Search.StartBalance;
                                this.transactionRawContainer.Search.EndBalance = result.Search.EndBalance;
                                this.transactionRawContainer.StoreItemRawTransactions = result.StoreItemRawTransactions || [];
                            } else if (response.data && response.data.errors) {
                                this.messages = response.data.errors;
                            } else {
                                this.messages.push('حدث خطأ أثناء تحميل التقرير');
                            }
                        })
                        .catch(error => {
                            // Demo: Add sample transactions for demonstration
                            this.transactionRawContainer.Search.StartBalance = 500;
                            this.transactionRawContainer.Search.EndBalance = 850;
                            this.transactionRawContainer.StoreItemRawTransactions = [
                                {
                                    TransDate: '2024-01-15T00:00:00',
                                    QTY: 200,
                                    QtyAfter: 700,
                                    Descrpition: 'شراء خام جديد',
                                    TransType: 0,
                                    TransTypeName: 'شراء',
                                    ReferanceId: 1
                                },
                                {
                                    TransDate: '2024-01-20T00:00:00',
                                    QTY: -100,
                                    QtyAfter: 600,
                                    Descrpition: 'استخدام في الإنتاج',
                                    TransType: 1,
                                    TransTypeName: 'تصنيع',
                                    ReferanceId: 2
                                },
                                {
                                    TransDate: '2024-01-25T00:00:00',
                                    QTY: 250,
                                    QtyAfter: 850,
                                    Descrpition: 'تسوية مخزون',
                                    TransType: 3,
                                    TransTypeName: 'تسوية',
                                    ReferanceId: 3
                                }
                            ];

                            console.warn('Using demo data. Replace with actual API call.');
                        });
                },
                formatDate(dateString) {
                    if (!dateString) return '';
                    const date = new Date(dateString);
                    return date.toLocaleDateString('ar-EG');
                },
                clearMessages() {
                    this.messages = [];
                }
            },
            mounted() {
                // Initialize balances if needed
                this.transactionRawContainer.Search.StartBalance = 0;
                this.transactionRawContainer.Search.EndBalance = 0;
            }
        }).mount('#app');
    </script>
</body>

</html>