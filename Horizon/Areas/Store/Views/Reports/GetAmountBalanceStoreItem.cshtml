@model List<StoreItemAmountReportsVM>
@{
    var title = "ارصدة المنتجات";
    ViewData["Title"] = title;
    string data = JsonConvert.SerializeObject(Model);
}

<div id="app" class="container mx-auto px-4 py-6">
    <!-- Card Header -->
    <div class="flex justify-between items-center mb-8 mt-4">
        <div class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                stroke="#000000" stroke-width="2" class="stroke-[#212b36]" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M3 3v18h18" />
                <path d="M18 17V9" />
                <path d="M13 17V5" />
                <path d="M8 17v-3" />
            </svg>
            <h1 class="text-2xl text-[#212b36] font-bold">{{ title }}</h1>
        </div>
    </div>

    <!-- Card Body -->
    <data-table :columns="columns" :data="items" :searchable="true" :sortable="true" :paginated="true"
        :per-page-options="[10, 25, 50, 100]" :default-per-page="25" search-placeholder="البحث في أرصدة المنتجات..."
        no-data-message="لا توجد بيانات متاحة" @@row-action="handleRowAction" @@row-click="handleRowClick"
        @@search-change="handleSearchChange" @@sort-change="handleSortChange" @@page-change="handlePageChange"
        ref="balancesTable">

        <!-- Summary Slot -->
        <template #summary>
            <div class="bg-gray-50 px-4 py-3 flex justify-between items-center border-t border-gray-200">
                <div class="text-sm text-gray-600">
                    إجمالي العناصر: <span class="font-medium">{{ totalItems }}</span>
                </div>
                <div class="text-sm text-gray-600">
                    النتائج المعروضة: <span class="font-medium">{{ searchResults }}</span>
                </div>
            </div>
        </template>
    </data-table>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
    <!-- Import the DataTable component -->
    <script type="module">
        import { DataTable } from '/assets/components/DataTable.js?v=2.6';

        const { createApp } = Vue;

        createApp({
            components: {
                DataTable
            },
            data() {
                return {
                    title: 'ارصدة المنتجات',
                    items: @Html.Raw(data),
                    totalItems: 0,
                    searchResults: 0,
                    currentPage: 1,
                    columns: [
                        {
                            key: 'StoreItemName',
                            label: 'المنتج',
                            sortable: true,
                            searchable: true,
                            width: 'w-2/5'
                        },
                        {
                            key: 'CurrentQty',
                            label: 'الكمية المتاحة',
                            sortable: true,
                            align: 'right',
                            format: (value) => {
                                if (value === null || value === undefined || value === '') return '0';
                                const num = parseFloat(value);
                                return num.toLocaleString('ar-EG') +
                                    (this.isUnitVisible ? ' ' + this.unitName : '');
                            }
                        },
                        {
                            key: 'DestroyedQty',
                            label: 'الكمية التالفة',
                            sortable: true,
                            align: 'right',
                            format: (value) => {
                                if (value === null || value === undefined || value === '') return '0';
                                const num = parseFloat(value);
                                return num.toLocaleString('ar-EG') +
                                    (this.isUnitVisible ? ' ' + this.unitName : '');
                            }
                        }
                    ],
                    isUnitVisible: true,
                    unitName: 'وحدة'
                }
            },
            mounted() {
                this.totalItems = this.items.length;
                this.searchResults = this.items.length;

                // Set document title
                document.title = this.title;
            },
            methods: {
                handleRowAction(event) {
                    const { action, item } = event;

                    switch (action) {
                        case 'details':
                            this.showItemDetails(item);
                            break;
                        case 'history':
                            this.showItemHistory(item);
                            break;
                    }
                },

                showItemDetails(item) {
                    // Implement your detail view logic here
                    console.log('Showing details for:', item);
                    // Example: window.location.href = `/Inventory/Details/${item.Id}`;
                },

                showItemHistory(item) {
                    // Implement history view logic here
                    console.log('Showing history for:', item);
                    // Example: window.location.href = `/Inventory/History/${item.Id}`;
                },

                handleRowClick(item) {
                    console.log('Row clicked:', item);
                },

                handleSearchChange(event) {
                    this.searchResults = event.results;
                },

                handleSortChange(event) {
                    console.log('Sort changed:', event);
                },

                handlePageChange(event) {
                    this.currentPage = event.page;
                }
            }
        }).mount('#app');
    </script>
}